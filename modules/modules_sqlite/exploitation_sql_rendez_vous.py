import sqlite3
from . import lire_sql as lsql


#En gros j'aimerais faire une fonction style : un medecin ajoute un motif de 
#rendez vous pour son cabinet avec un temps specifique
#Il peut creer ce rdv ssi il n'en existe pas deja un pour sa profession ie si 
#pour travail donne on a pas de motif deja alors on peut en creer


def rdv_existe(travail, motif):
    """cette fonction sert a un praticien pour rechercher s'il existe un motif
    de rendez-vous pour son domaine et si oui combien de temps ca dure, 
    elle renvoie [False, 0] s'il n'existe pas de tel motif pour sa profession
    et elle renvoie [True, temps_du_rendez_vous] s'il en existe un"""
    connection = lsql.connection_bdd()
    cursor = connection.cursor()
    cursor.execute("SELECT temps FROM rdvs WHERE type_de_medecin = ? AND motif = ?", (travail, motif))
    rech = cursor.fetchall()
    connection.close()
    if rech == [] :
        return [False, 0]#on renvoie False ainsi pour simplifier le traitement
                         #de l'output de cette fonction dans les fonctions 
                         #annexes l'utilisant (avoir le meme type de sortie)
    else :
        return [True, rech[0][0]]



def creer_rdv(type_de_medecin, motif, temps):
    """cette fonction inscrit dans la base de donnee un nouveau motif de rendez
    vous pour seulement un certain type de medecin"""
    if rdv_existe(type_de_medecin, motif)[0] == True:
        #return f"pour la profession choisie, un rdv de ce motif existe deja, il est de {rdv_existe(type_de_medecin, motif)[1]} minutes"
        pass
    elif temps <= 0 :#le rendez vous doit prendre une valeur de temps positive
        pass
    elif temps%15 == 0:#nous travaillons avec des tranches de 15 minutes, le rendez vous doit en etre un multiple
        pass
    else :
        connection = lsql.connection_bdd()
        cursor = connection.cursor()
        cursor.execute("INSERT INTO rdvs VALUES (?,?,?)", (type_de_medecin, motif, temps))
        connection.commit()
        connection.close()
        #return "le rendez vous a bien ete cree"

def supprimer_rdv(type_de_medecin, motif):
    """cette fonction supprime un motif de rendez vous pour un certain type de
    medecin precisement dans la base donnees et table rdvs"""
    if rdv_existe(type_de_medecin, motif)[0] == True :
        connection = lsql.connection_bdd()
        cursor = connection.cursor()
        cursor.execute("DELETE FROM rdvs WHERE type_de_medecin = ? AND motif = ?", (type_de_medecin, motif))
        connection.commit()
        connection.close()
        #return f"rdv pour {motif} concernant {type_de_medecin} de {rdv_existe(type_de_medecin, motif)[1]} minutes a bien ete supprimme"
    else :
        #return "impossible de supprimer un type de rdv pour votre profession qui n'existe pas"
        pass

    
if __name__ == '__main__' :
    
    """
    print (rdv_existe("generaliste", "vaccin"))
    """
    
    """
    print (creer_rdv("veterinaire", "arrivee d'hospitlisation", 45))
    """
    
    """
    print (supprimer_rdv("generaliste", "vacin"))
    """
