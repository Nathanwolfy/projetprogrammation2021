import emploidutemps as e

JOURS = ["Lundi", "Mardi", "Mercredi", "Jeudi", "Vendredi", "Samedi", "Dimanche"]
MOIS = [i for i in range(1, 13)] #[1 #Janvier, 2 #Février, ...]


def load_edt(fichier):
    with open(fichier) as file:
        for (i, horaire) in enumerate(file): #Lundi 22 01 2021 8 00 motif 15
            H = horaire.split()
            if i == 0:
                edt = e.Edt(H[0], int(H[1]), int(H[2]), int(H[3]))
                heure_journee = int(H[4]) # Heure du début de la journée
                minute_journee = int(H[5]) # Minute du début de la journée
                horaire_debut_boucle_while = e.Heure(heure_journee, minute_journee)  #Heure du début de la journée
            jour = H[0]
            heure_rdv = int(H[4])
            minute_rdv = int(H[5])
            heure_debut = e.Heure(heure_rdv, minute_rdv) # Heure du rdv
            motif = e.Motif(H[6], int(H[-1]))
            for j in range(7):
                if jour == JOURS[j]:
                    while horaire_debut_boucle_while.compare(heure_debut): #hor_deb_bou_whi <= heure_debut
                        if minute_journee == 45:
                            heure_journee += 1
                            minute_journee = 0
                            horaire_debut_boucle_while = e.Heure(heure_journee, minute_journee)
                        else:
                            minute_journee += 15
                            horaire_debut_boucle_while = e.Heure(heure_journee, minute_journee)
                    edt.modifier(j, heure_debut.repr, motif) #plus de la classe Heure, seulement la représentation, pour pouvoir y accéder après
    return edt


def edt_creneaux_libres(edt, heure_debut, heure_fin):
    edt_creneaux_vides = e.Edt(edt.lundi, edt.nb_lundi, edt.mois_lundi, edt.annee)
    Liste_heure = []
    for jour in range(7):
        for heure in range(heure_debut.heure, heure_fin.heure):
            for minute in range(0, 46, 15):
                heure_rdv = e.Heure(heure, minute)
                try:
                    motif = edt.un_jour_de_edt(jour).un_horaire(heure_rdv.repr)
                    duree_rdv = motif.duree
                    duree_boucle = duree_rdv // 15
                    Liste_heure = []
                    heure_i = heure_rdv
                    for i in range(duree_boucle-1):
                        if heure_i.minute == 45:
                            heure_i.heure += 1
                            heure_i.minute = 0
                            heure_i = e.Heure(heure_i.heure, heure_i.minute)
                        else:
                            heure_i.minute += 15
                            heure_i = e.Heure(heure_i.heure, heure_i.minute)
                        Liste_heure.append(heure_i.repr)
                except KeyError:
                    duree_plus_15_min = False
                    for i in range(len(Liste_heure)):
                        if heure_rdv.repr == Liste_heure[i]:
                            duree_plus_15_min = True
                    if duree_plus_15_min == False:
                        edt_creneaux_vides.modifier(jour, heure_rdv.repr, '')
        try:
            edt.un_jour_de_edt(jour).un_horaire(heure_fin.repr)
        except KeyError:
            edt_creneaux_vides.modifier(jour, heure_fin.repr, '')
    return edt_creneaux_vides


def ajouter_rdv(fichier, heure_rdv, motif, duree_rdv):
    file = open(fichier)

if __name__ == '__main__':

    edt = load_edt('Test_edt2.txt')
    print(edt)
    edt_libre = edt_creneaux_libres(edt, e.Heure(8, 0), e.Heure(22, 0))
    print(edt_libre)
    print(edt_libre.un_jour_de_edt(0))
