import profil as p
import base_donnee_texte as bdd


#Potentiellement pour la suite :


def recherche_medecin(string):
    """Cette fonction permet de prendre une chaine de caract en parametre, et retourne parmis tous les 
    medecins existants ceux avec une chaine matchante, c'est pour voir si quelqu'un est enregistré et
    avoir accès à ses données"""
    recherche = []
    with open("medecins.txt", "r") as f:
        for line in f:
            l = line.split()
            doc = p.Docteur()
            adresse = ""
            for elt in l[5:]:
                adresse += " " + elt
            doc.saisie(l[1], l[2], l[3], l[4], adresse, l[0])
            for i in range(len(l)):
                if l[i] == str(string):
                    recherche.append(doc)
    if recherche == []:
        return "La recherche n'a pas aboutie"
    else:
        return recherche


def indice_ligne_medecin(mail):
    """cette fonction renvoie -1 : le medecin dont le mail à été rentré n'existe pas
    c'est à dire on peut le créer, sinon cette fonction renvoie l'indice de la ligne
    c'est à dire l'indice de la liste dans laquelle on peut stocker les lignes + 1"""
    indiceligne = -1
    with open("medecins.txt", "r") as f:
        lignes = f.readlines()
        for texte in lignes:
            l = texte.split()
            if l[3] == mail :
                indiceligne = lignes.index(texte) + 1
    return indiceligne


def creer_medecin(metier, prenom, nom, mail, telephone, adresse):
    """Cette fonction créé un nouveau medecin et rentre ses elements dans la base de donée, 
    elle retournera une erreur si le medecin s'est déjà enregistré avec ce mail"""
    indligne = indice_ligne_medecin(mail)
    if indligne == -1:
        fichier = open ("medecins.txt", "a")
        fichier.write("\n" + str(metier) + " " + str(prenom) + " " + str(nom) + " " + str(mail) + " " + str(telephone) + " " + str(adresse))
        fichier.close()
        return "le medecin a bien été créé"
    else :
        return "Un medecin avec le même mail existe déjà sur notre application doctobélix"


#Je m'arrête ici


"""
def supprimer_patient(mail):
    ""ce programme permet de supprimer un patient de la base de donnée en supprimant ses 
    données également""
    indligne = indice_ligne_patient(mail)
    if indligne == -1:
        return "le patient que vous essayez de supprimer n'existe pas encore sur doctobélix"
    else :
        with open("patients.txt", "r") as f:
            lignes = f.readlines()
        lignes.pop(indligne - 1)
        with open("patients.txt", "w") as f:
            f.writelines(lignes)
"""
            

def supprimer_patient(mail):
    """ce programme permet de supprimer un patient de la base de donnée en supprimant ses 
    données également"""
    indligne = indice_ligne_patient(mail)
    if indligne == -1:
        return "le patient que vous essayez de supprimer n'existe pas encore sur doctobélix"
    else :
        with open("patients.txt", "r") as f:
            lignes = f.readlines()
        deleted_text = lignes.pop(indligne - 1)
        with open("patients.txt", "w") as f:
            for ligne in lignes:
                if ligne != str(deleted_text) + "\n" :
                    f.write(ligne)



"""
def supprimer_patient(mail):
    indligne = indice_ligne_patient(mail)
    old = ""
    if indligne == -1:
        return "le patient que vous essayez de supprimer n'existe pas encore sur doctobélix"
    else :
        with open("patients.txt", "r") as f:
            lignes = f.readlines()
        lignes.pop(indligne - 1)
        for elt in lignes:
            old += elt
        l = old.split("\n")
        #old = ""
        #for elt in l:
        #    old += elt
        with open("patients.txt", "w") as f:
            n = len(l)
            for i in  range(n - 1):
                f.write(l[i] + "\n")
        with open("patients.txt", "a") as f:
            f.write(l[n-1])
"""


def modifier_patient(prenom, nom, jour, mois, annee, mail, telephone, adresse):
    """but : modifier la ligne d'un patient à partir de son mail, qui est par définition
    unique"""
    indligne = indice_ligne_patient(mail)
    if indligne == -1:
        return "Le patient à modifier n'a pas été trouvé dans notre application doctobélix"
    else:
        supprimer_patient(mail)
        creer_patient(prenom, nom, jour, mois, annee, mail, telephone, adresse)
        return "le patient a été modifié"


if __name__ == "__main__" :
    
    """
    fin_de_recherche = recherche_medecin("jules")
    print(fin_de_recherche)
    """
    
    """
    a = indice_ligne_medecin("mag_kine@alumni.enac.org")
    print(a)
    """
    
    """
    c = indice_ligne_medecin("the.weng.06@gmail.com")
    print(c)
    """
    
    """
    d = creer_medecin("pediatre", "zelvac", "coptim", "zelvac_mc_pro@gmail.com", "0264879314", "9 boulevard Le Cleach LOGUIVY-DE-LA-MER 22500 FRANCE")
    print(d)
    """


#Je m'arrête ici


    """e = supprimer_patient("fantacoeurfrigiel@yahoo.fr")  
    print(e)"""
    
    """d = modifier_patient("joseph", "bellobitto", 5, 12, 2001, "jojo.bizarre@venture.com", "0684397515", "Lieu dit Le GENEPI POILLEY 76950 FRANCE")
    print (d)"""